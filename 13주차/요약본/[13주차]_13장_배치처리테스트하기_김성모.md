# 13장. 배치 처리 테스트하기

## JUnit과 Mockito를 사용한 단위 테스트

> 단위 테스트란? 격리된 단일 컴포넌트를 반복 가능한 방식으로 수행하는 테스트

단위테스트 시 다음의 정의를 구체화한다.

- 단일 테스트 : 단 하나를 테스트한다. 최소 컴포넌트를 테스트하며 메소드 단위라고 보면 된다.
- 격리 : 의존성은 시스템 테스트 시 혼란을 줄 수 있다. 따라서 각 의존성의 통합을 테스트하지 않고 개별 컴포넌트의 동작 방식을 테스트하는 것이다.
- 반복 가능한 방식 : 브라우저를 매번 띄워 클릭하는 것이 아니라 동일한 시나리오를 반복해서 수행할 수 있어야 한다.

### JUnit
> 표준화된 단위테스트를 할 수 있는 기능을 제공하는 간단한 프레임 워크이다.

#### Junit 생명주기

생성자가 아규먼트를 갖지 않는 클래스를 만들고 @Test 어노테이션을 붙여서 테스트 메소드를 만들 수 있다.

각 테스트는 메서드 이전에 실행할 것과 이 후에 실행할 것으로 나눌 수 있고
이때는 각각 `@BeforeEach` 와 `@AfterEach` 를 사용할 수 있고 `public void` 상태여야 한다.

#### Mock 객체

배치 잡이 수십 개 이상 클래스를 필요로 할 수 있고 외부 시스템에 의존할 수도 있다.
이런 모든 가변적인 영역을 관리하기가 어려우므로 목객체를 사용해 외부 의존성의 영향없이 비즈니스 로직을 실행한다.

목 객체에 접근 방식에는 2가지가 있다. 
1. 프록시 기반
2. 클래스 재매핑 방식 


## 스프링 배치의 유틸리티를 사용한 통합 테스트

### 스프링을 사용해 통합 테스트하기

> 코어 스프링의 통합 테스트 기능을 사용해 통합 테스트를 수행하는 두 가지 주요 사용 사례는 다음과 같다.

1. 데이터베이스와 상호작용을 테스트하는 것
2. 스프링 빈과의 상호작용을 테스트하는 것

### 스프링 배치 테스트하기

#### 잡과 스텝 스코프 빈 테스트하기
- @ExtendWith(SpringExtenstion.class) : JUnit 5가 제공하는 스프링의 기능을 사용할 수 있게 한다.
- @JdbcTest : 데이터 베이스 테스트를 할 때 테스트 관련 기능을 제공한다.
- @ContextConfiguration : ApplicationContext를 빌드하는데 필요한 클래스를 제공한다.
- @SpringBatchTest : 스프링 배치를 쉽게 테스트할 수 있는 유틸리티(JobLauncherTestUtils)를 제공한다.    
- @Transactional(propagation=Propagation.NOT_SUPPORTED) : 메서드 완료 시 롤백한다. @JdbcTest 애너테이션의 트래잭션 기능이 동작하지 않게 비활성화한다.    